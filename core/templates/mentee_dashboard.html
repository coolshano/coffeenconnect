{% load static %}
<!DOCTYPE html>
<html>
<head>
<title>Mentee Dashboard</title>

<style>
html, body {
    height: 100%;
    margin: 0;
}

body {
    font-family: "Segoe UI", system-ui;
    background: linear-gradient(135deg, #0d6efd, #ff9800);
    display: flex;
    flex-direction: column;
}

/* HEADER */
.app-header {
    height: 70px;
    background: rgba(255,255,255,0.95);
    backdrop-filter: blur(10px);
    display: flex;
    align-items: center;
    padding: 0 40px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.1);
}

.logo {
    font-size: 22px;
    font-weight: 800;
    color: #0d6efd;
}

/* MAIN */
.app-main {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: stretch;
    padding: 40px 0;
}

/* GLASS LAYOUT */
.layout {
    display: grid;
    grid-template-columns: 300px 1fr;
    width: 100%;
    max-width: 1200px;
    gap: 30px;
    padding: 40px;
    background: rgba(255,255,255,0.95);
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.15);
}

/* LEFT PANEL */
.profile {
    background:white;
    border-radius:18px;
    padding:30px;
    box-shadow:0 10px 35px rgba(0,0,0,0.08);
    display:flex;
    flex-direction:column;
    text-align:center;
}

.profile img {
    width:120px;
    height:120px;
    border-radius:50%;
    object-fit:cover;
    margin-bottom:12px;
}

.profile h2 {
    margin:10px 0 2px;
    font-size:24px;
}

.profile h4 {
    margin:0;
    color:#666;
}

/* bottom buttons */
.profile-actions {
    margin-top:auto;
    display:flex;
    flex-direction:column;
    gap:14px;
}

.profile-btn {
    width:100%;
    padding:14px 0;
    border-radius:10px;
    font-weight:600;
    border:none;
    cursor:pointer;
    text-decoration:none;
    text-align:center;
}

.profile-btn.edit { background:#0d6efd; color:white; }
.profile-btn.logout { background:#dc3545; color:white; }
.profile-btn.password { background:#6c757d; color:white; }

/* RIGHT PANEL */
.matches {
    display:flex;
    flex-direction:column;
    height:100%;
}

.matches h1 {
    flex-shrink:0;
    margin-bottom:20px;
}

/* Scrollable list */
.matches-list {
    flex:1;
    overflow-y:auto;
    padding-right:10px;
}

/* Mentor cards */
.card {
    background:white;
    border-radius:16px;
    padding:22px 26px;
    margin-bottom:20px;
    box-shadow:0 10px 25px rgba(0,0,0,0.08);
    display:grid;
    grid-template-columns: 1fr 100px 140px;
    align-items:center;
    gap:20px;
}

.mentor h3 {
    margin:0;
    color:#0d6efd;
}

.mentor p {
    margin-top:6px;
    font-size:14px;
    color:#444;
}

.score {
    font-size:20px;
    font-weight:800;
    color:#16a34a;
    text-align:center;
}

.card-actions {
    display:flex;
    justify-content:flex-end;
}

.btn {
    padding:12px 22px;
    border-radius:10px;
    border:none;
    font-weight:600;
    cursor:pointer;
}

.pending { background:#ffc107; }
.accepted { background:#0d6efd; color:white; }

/* FOOTER */
.app-footer {
    background: rgba(255,255,255,0.95);
    padding:25px 40px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    box-shadow:0 -5px 20px rgba(0,0,0,0.1);
}
</style>
</head>

<body>

<div class="app-header">
    <div class="logo">ConnectMe</div>
</div>

<div class="app-main">
    <div class="layout">

        <!-- LEFT -->
        <div class="profile">
            {% if mentee.profile_image %}
                <img src="{{ mentee.profile_image.url }}">
            {% else %}
                <img src="{% static 'core/images/default-avatar.png' %}">
            {% endif %}

            <h2>{{ mentee.name }}</h2>
            <h4>{{ mentee.country }}</h4>

            <div class="profile-actions">
                <a href="/mentee/profile/" class="profile-btn edit">Edit Profile</a>

                <form method="post" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button class="profile-btn logout">Logout</button>
                </form>

                <a href="{% url 'password_change' %}" class="profile-btn password">
                    Change Password
                </a>
            </div>
        </div>

        <!-- RIGHT -->
        <div class="matches">
            <h2>Your Mentor Matches</h2>

            <div class="matches-list" id="matches-list">
                {% for m in mentors|slice:":3" %}
                <div class="card">
                    <div class="mentor">
                        <h3>{{ m.mentor.name }}</h3>
                        <h4>{{ m.mentor.country }}</h4>
                        <p>{{ m.mentor.profile_text|truncatewords:18 }}</p>
                    </div>

                    <div class="score">{{ m.score }}%</div>

                    <div class="card-actions">
                        {% if m.status == "pending" %}
                            <button class="btn pending">Pending</button>
                        {% elif m.status == "accepted" %}
                            <button class="btn accepted">Connected</button>
                        {% else %}
                            <form method="post" action="{% url 'request_mentor' m.mentor.id %}">
                                {% csrf_token %}
                                <button class="btn">Request</button>
                            </form>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>

<div class="app-footer">
    <div>© 2026 ConnectMe · All rights reserved</div>
    <div>Privacy · Terms · Support</div>
</div>

<!-- Infinite Scroll Script -->
<script>
let page = 1;
let loading = false;
const list = document.getElementById("matches-list");

list.addEventListener("scroll", () => {
    if (loading) return;

    if (list.scrollTop + list.clientHeight >= list.scrollHeight - 100) {
        loadMore();
    }
});

function loadMore() {
    loading = true;
    page++;

    fetch(`/load-more-mentors/?page=${page}`)
        .then(res => res.text())
        .then(html => {
            if (html.trim() !== "") {
                list.insertAdjacentHTML("beforeend", html);
            }
            loading = false;
        });
}
</script>

</body>
</html>
